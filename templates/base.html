<!DOCTYPE html>
<html>

<head>
    <title>GoalFit AI</title>
    <link rel="icon" type="image/png" href="/static/images/logo.png">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>

<!-- Page Loading Overlay -->
<div class="loading-overlay" id="pageLoader">
    <div class="loading-content">
        <div class="loader-title">
            <span class="loader-text left">GOAL</span>
            <span class="loader-dot"></span>
            <span class="loader-text right">FIT</span>
        </div>
        <p>Loading your fitness journey...</p>
    </div>
</div>

<script>
    // Hide loading overlay when page is fully loaded
    window.addEventListener('load', function() {
        const loader = document.getElementById('pageLoader');
        if (loader) {
            loader.style.transition = 'opacity 0.6s ease-in-out';
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
            }, 600);
        }
    });
</script>

{% set is_auth = request.endpoint in ['auth.login', 'auth.register'] %}

{% if not is_auth %}
    <div class="layout">

        <!-- ===== SIDEBAR ===== -->
        <aside class="sidebar">

            <!-- Logo -->
            <div>
                <div class="logo">
                    <img src="/static/images/logo.png" alt="GoalFit AI" class="logo-img">
                    <div class="logo-text">
                        <h2>GOALFIT</h2>
                        <p>AI ENGINE</p>
                    </div>
                </div>

                <!-- Navigation -->
                <nav class="menu">

                    <a href="/dashboard" class="nav-item">
                        <svg class="icon" viewBox="0 0 24 24">
                            <!-- <path d="M3 13h8V3H3v10zm10 8h8V3h-8v18z" /> -->
                            <rect width="7" height="9" x="3" y="3" rx="1"></rect>
                            <rect width="7" height="5" x="14" y="3" rx="1"></rect>
                            <rect width="7" height="9" x="14" y="12" rx="1"></rect>
                            <rect width="7" height="5" x="3" y="16" rx="1"></rect>
                        </svg>
                        <span>Dashboard</span>
                    </a>

                    <a href="/diet-plan" class="nav-item">
                        <svg class="icon" viewBox="0 0 24 24">
                            <!-- <path d="M3 3h18v2H3zm4 6h10v2H7zm-4 6h18v2H3z" /> -->
                            <path d="M7 21h10"></path>
                            <path d="M12 21a9 9 0 0 0 9-9H3a9 9 0 0 0 9 9Z"></path>
                            <path
                                d="M11.38 12a2.4 2.4 0 0 1-.4-4.77 2.4 2.4 0 0 1 3.2-2.77 2.4 2.4 0 0 1 3.47-.63 2.4 2.4 0 0 1 3.37 3.37 2.4 2.4 0 0 1-1.1 3.7 2.51 2.51 0 0 1 .03 1.1">
                            </path>
                            <path d="m13 12 4-4"></path>
                            <path d="M10.9 7.25A3.99 3.99 0 0 0 4 10c0 .73.2 1.41.54 2"></path>
                        </svg>
                        <span>Diet Plan</span>
                    </a>

                    <a href="/workout-plan" class="nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" class="lucide lucide-dumbbell w-4 h-4" aria-hidden="true">
                            <path
                                d="M17.596 12.768a2 2 0 1 0 2.829-2.829l-1.768-1.767a2 2 0 0 0 2.828-2.829l-2.828-2.828a2 2 0 0 0-2.829 2.828l-1.767-1.768a2 2 0 1 0-2.829 2.829z">
                            </path>
                            <path d="m2.5 21.5 1.4-1.4"></path>
                            <path d="m20.1 3.9 1.4-1.4"></path>
                            <path
                                d="M5.343 21.485a2 2 0 1 0 2.829-2.828l1.767 1.768a2 2 0 1 0 2.829-2.829l-6.364-6.364a2 2 0 1 0-2.829 2.829l1.768 1.767a2 2 0 0 0-2.828 2.829z">
                            </path>
                            <path d="m9.6 14.4 4.8-4.8"></path>
                        </svg>

                        <span>Workouts</span>
                    </a>

                    <a href="/progress" class="nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" class="lucide lucide-trending-up w-4 h-4" aria-hidden="true">
                            <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                            <polyline points="16 7 22 7 22 13"></polyline>
                        </svg>
                        <span>Progress</span>
                    </a>

                    <a href="/health" class="nav-item">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 12a5 5 0 100-10 5 5 0 000 10zm0 2c-5 0-9 3-9 6v2h18v-2c0-3-4-6-9-6z" />
                        </svg>
                        <span>Profile</span>
                    </a>

                </nav>
            </div>

            <!-- Bottom User Section -->
            <div class="user-box">

                <div class="avatar">
                    {{ session.get('user_name', 'U')[0] if session.get('user_name') else 'U' }}
                </div>

                <div class="user-info">
                    <p>{{ session.get('user_name', '') }}</p>
                    <p class="user-email">{{ session.get('email', '') }}</p>
                    <a href="/logout" class="logout-btn">Logout</a>
                </div>

            </div>

        </aside>


        <!-- ===== MAIN CONTENT ===== -->
        <main class="content">
            {% block content %}{% endblock %}
        </main>

    </div>
    {% else %}
    
        <!-- Auth pages render full screen -->
        {% block auth_content %}{% endblock %}
    
    {% endif %}
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script>
    // Highlight active menu item
    document.addEventListener('DOMContentLoaded', function() {
        const currentEndpoint = '{{ request.endpoint }}';
        const navItems = document.querySelectorAll('.nav-item');
        
        const menuMap = {
            'dashboard.dashboard': '/dashboard',
            'diet.diet_plan': '/diet-plan',
            'workout.workout_plan': '/workout-plan',
            'progress.progress_page': '/progress',
            'health.health_profile': '/health'
        };
        
        navItems.forEach(item => {
            const href = item.getAttribute('href');
            item.classList.remove('active');
            if (menuMap[currentEndpoint] === href) {
                item.classList.add('active');
            }
        });
    });
</script>

</body>

</html>